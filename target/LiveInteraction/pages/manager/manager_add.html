<!DOCTYPE html><html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>河南广播电视台 - 管理员</title>
        <meta name="keywords" content="index">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="renderer" content="webkit">
        <meta http-equiv="Cache-Control" content="no-siteapp" />
        <link rel="icon" type="image/png" href="assets/i/favicon.png">
        <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">
        <meta name="apple-mobile-web-app-title" content="Amaze UI" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

        <link rel="stylesheet" href="/static/css/amazeui.min.css" />
        <link rel="stylesheet" href="/static/css/admin.css">
        <link rel="stylesheet" href="/static/css/app.css">
        <script src="/static/js/echarts.min.js"></script>
    </head>

    <body data-type="index">
        <header class="am-topbar am-topbar-inverse admin-header">
            <div class="am-topbar-brand">
                <a href="javascript:;" class="tpl-logo">
                    <img src="/static/img/logo.png" alt="">
                </a>
            </div>
            <div class="am-icon-list tpl-header-nav-hover-ico am-fl am-margin-right"></div>

            <button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#topbar-collapse'}"><span class="am-sr-only">导航切换</span> <span class="am-icon-bars"></span></button>

            <div class="am-collapse am-topbar-collapse" id="topbar-collapse">
                <ul class="am-nav am-nav-pills am-topbar-nav am-topbar-right admin-header-list tpl-header-list">
                    <li class="am-dropdown" data-am-dropdown data-am-dropdown-toggle>
                        <a class="am-dropdown-toggle tpl-header-list-link" href="javascript:;">
                            <div id="weather"></div>
                        </a>
                        <ul class="am-dropdown-content tpl-dropdown-content">
                            <li class="tpl-dropdown-content-external">
                                <h3>当前城市 <span class="tpl-color-success" id="weatherCity"></span></h3>
                            </li>
                            <li class="tpl-dropdown-content-external">
                                <div id="dayPicture"></div>
                                <div id="temperature" style="padding-top: 20px;"></div>
                                <div id="wind" style="padding-top: 10px;"></div>
                            </li>
                        </ul>
                    </li>
                    <li class="am-hide-sm-only"><a href="javascript:;" id="admin-fullscreen" class="tpl-header-list-link"><span class="am-icon-arrows-alt"></span> <span class="admin-fullText">开启全屏</span></a></li>
                    <li class="am-dropdown" data-am-dropdown data-am-dropdown-toggle>
                        <a class="am-dropdown-toggle tpl-header-list-link" href="javascript:;">
                            <span class="tpl-header-list-user-ico"> <img id="loginIcon" src="/static/img/default.jpg"></span>
                        </a>
                        <ul class="am-dropdown-content">
                            <li id="logout"><a href="#"><span class="am-icon-power-off"></span> 退出</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </header>

        <div class="tpl-page-container tpl-page-header-fixed">

            <div class="tpl-left-nav tpl-left-nav-hover">
                <div class="tpl-left-nav-title">
                    操作列表
                </div>
                <div class="tpl-left-nav-list">
                    <ul class="tpl-left-nav-menu">
                        <li class="tpl-left-nav-item">
                            <a href="permission_list.html" class="nav-link">
                                <i class="am-icon-unlock-alt"></i>
                                <span>权限</span>
                            </a>
                        </li>
                        <li class="tpl-left-nav-item">
                            <a href="role_list.html" class="nav-link tpl-left-nav-link-list">
                                <i class="am-icon-gittip"></i>
                                <span>角色</span>
                            </a>
                        </li>
                        <li class="tpl-left-nav-item">
                            <a href="manager_list.html" class="nav-link tpl-left-nav-link-list active">
                                <i class="am-icon-user"></i>
                                <span>用户</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!--内容展示区-->
            <div class="row">

                <div class="am-u-md-12">
                    <!--中间显示记录列表分页信息-->
                    <div class="tpl-portlet">
                        <div class="tpl-portlet-title">
                            <div class="tpl-caption" style="color:#3bb4f2">
                                <i class="am-icon-user"></i>
                                <span> 用户管理 - 添加用户</span>
                            </div>
                        </div>

                        <div class="tpl-echarts">
                            <div class="tpl-block">
                                <div class="am-g">
                                    <div class="am-u-sm-12 am-u-md-3">
                                        <div class="am-input-group am-input-group-sm">
                                            <input type="text" class="am-form-field" id="contentText" placeholder="输入姓名进行查询">
                                            <span class="am-input-group-btn">
                                                <button class="am-btn am-btn-secondary tpl-am-btn-secondary am-icon-search" type="button" id="searchBtn"></button>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="am-g">
                                    <div class="am-u-sm-12">
                                        <form class="am-form">
                                            <table class="am-table am-table-hover table-main">
                                                <thead>
                                                    <tr>
                                                        <th class="table-id" style="width: 100px;">编号</th>
                                                        <th class="table-id" style="width: 100px;">姓名</th>
                                                        <th class="table-id" style="width: 100px;">手机号</th>
                                                        <th class="table-id" style="width: 100px;">头像</th>
                                                        <th class="table-id" style="width: 100px;">来源</th>
                                                        <th class="table-id" style="width: 100px;">创建时间</th>
                                                        <th class="table-id" style="width: 150px;">操作</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="managerContent">

                                                </tbody>
                                            </table>
                                            <div class="am-cf">
                                                <div class="am-fr" style="font-size: 14px;">
                                                    <ul class="am-pagination tpl-pagination" id="pagination"></ul>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="http://www.jq22.com/jquery/jquery-2.1.1.js"></script>
        <script src="/static/js/amazeui.min.js"></script>
        <!--分页插件-->
        <script src="/static/js/jqPaginator.min.js" type="text/javascript"></script>
        <!--天气插件-->
        <script src="/static/js/template-native.js" title="text/javascript"></script>
        <script>
            var data = {
                pageNum : 1,// 当前页
                pageSize : 10,// 每页显示多少数据
                content : ''// 要查询的内容
            };

            $(function() {
                Init();
            });
            function Init() {
                onLoad();
                bindEvent();
            }
            function onLoad() {
                // 开启/退出全屏
                var $fullText = $('.admin-fullText');
                $('#admin-fullscreen').on('click', function() {
                    $.AMUI.fullscreen.toggle();
                });
                $(document).on($.AMUI.fullscreen.raw.fullscreenchange, function() {
                    $fullText.text($.AMUI.fullscreen.isFullscreen ? '退出全屏' : '开启全屏');
                });
                getUserInfo();
                // 加载最新消息列表
                addItems(data.pageNum, data.pageSize);
                // 加载天气信息
                getCityWeather('郑州');
            }
            function getUserInfo() {
                $.ajax({
                    url : '/manager/get_user_info.do',
                    type : 'POST',
                    dataType : 'json',
                    contentType : false,
                    processData : false,
                    cache : false,
                    success: function(res) {
                        console.log(res)
                        if (res.status === 0) {
                            var icon = res.data.icon;
                            if (icon === null || icon === 'undefined' || icon === '') {
                                $('#loginIcon').attr('src', '/static/img/default.jpg');
                            } else {
                                $('#loginIcon').attr('src', res.data.icon);
                            }
                        } else if (res.status == 10) {// 需要登录
                            window.location.href = 'http://uc.hndt.com/login.xhtml';
                        } else {
                            alert(res.msg);
                        }
                    },
                    error : function(errMsg) {
                        alert('好像哪里不对了');
                    }
                });
            }
            function addItems(pageNum, pageSize) {
                var formData = new FormData();
                formData.append("pageNum", pageNum);
                formData.append("pageSize", pageSize);
                formData.append("name", data.content);

                $.ajax({
                    url : '/manager/user_center_list.do',
                    data : formData,
                    type : 'POST',
                    dataType : 'json',
                    contentType : false,
                    processData : false,
                    cache : false,
                    success: function(res) {
                        console.log(res);
                        if (res.status == 0) {
                            var userList = res.data.data.list;

                            var html = '';
                            $.each(userList, function(index, item) {
                                var iconImg = '';
                                if (item.icon === '' || item.icon === undefined || item.icon === null) {
                                    iconImg = '<img class="am-circle" src="/static/img/default.jpg" width="100" height="100"/>';
                                } else {
                                    iconImg = '<img class="am-circle" src="' + item.icon + '" width="100" height="100"/>';
                                }

                                html +=  '<tr>' +
                                        '<td>' + item._id + '</td>' +
                                        '<td>' + item.name + '</td>'+
                                        '<td>' + item.mobile + '</td>'+
                                        '<td>' + iconImg + '</td>'+
                                        '<td>' + item.origin + '</td>'+
                                        '<td>' + getMyDate(item.createTime) + '</td>'+
                                        '<td>'+
                                        '<button type="button" id="addLocalBtn" data-id="' + item._id + '" data-name="' + item.name + '" data-icon="' + item.icon + '" class="am-btn am-btn-default am-btn-xs am-text-secondary" style="background-color: white"><span class="am-icon-level-down"></span> 添加到本地</button>'+
                                        '</td>'+
                                        '</tr>';
                            });
                            $('#managerContent').html(html);

                            // 设置分页
                            loadPage(res.data.data.pages, res.data.data.page, res.data.data.rows);
                        } else if (res.status == 10) {// 需要登录
                            window.location.href = 'http://uc.hndt.com/login.xhtml';
                        } else {
                            alert(res.msg)
                        }
                    },
                    error : function(errMsg) {
                        alert('好像哪里不对了');
                    }
                });
            }
            function bindEvent() {
                // 头部导航隐藏菜单
                $('.tpl-header-nav-hover-ico').on('click', function() {
                    $('.tpl-left-nav').toggle();
                    $('.tpl-content-wrapper').toggleClass('tpl-content-wrapper-hover');
                });
                // 搜索框的点击事件
                $('#searchBtn').click(function() {
                    data.content = $.trim($('#contentText').val());
                    addItems(data.pageNum, data.pageSize);
                });
                // 将用户中心用户添加到本地
                $('body').on('click','#addLocalBtn',function() {
                    var id = $(this).data('id');
                    var name = $(this).data('name');
                    var icon = $(this).data('icon');

                    $.ajax({
                        url : '/manager/user_center_to_local.do',
                        data : {
                            id : id,
                            name : name,
                            icon : icon
                        },
                        type : 'POST',
                        dataType : 'json',
                        success : function(res) {
                            if (res.status == 0) {
                                window.location.href = '/pages/manager/manager_list.html';
                            } else if (res.status == 10) {// 需要登录
                                window.location.href = 'http://uc.hndt.com/login.xhtml';
                            } else {
                                alert(res.msg);
                            }
                        },
                        error : function(err) {
                            alert('好像哪里不对了')
                        }
                    });
                });
                // 退出登录
                $('#logout').click(function() {
                    $.ajax({
                        url : '/manager/log_out.do',
                        type : 'POST',
                        dataType : 'json',
                        success : function(res) {
                            if (res.status == 0) {
                                window.location.href = 'http://uc.hndt.com/login.xhtml';
                            } else if (res.status == 10) {
                                window.location.href = 'http://uc.hndt.com/login.xhtml';
                            } else {
                                alert(res.msg);
                            }
                        },
                        error : function(err) {
                            progress.done();
                            alert('好像哪里不对了')
                        }
                    });
                });
            }
            // 加载分页信息（使用分页插件）
            function loadPage(pages, pageNum, total) {
                $.jqPaginator('#pagination', {
                    totalPages: pages,
                    visiblePages: 5,
                    currentPage: pageNum,
                    first: '<li class="first"><a href="javascript:;">首页</a></li>',
                    prev: '<li class="prev"><a href="javascript:;"><i class="arrow arrow2"></i>上一页</a></li>',
                    next: '<li class="next"><a href="javascript:;">下一页<i class="arrow arrow3"></i></a></li>',
                    last: '<li class="last"><a href="javascript:;">末页</a></li>',
                    page: '<li class="page"><a href="javascript:;">{{page}}</a></li>',
                    onPageChange: function (num, type) {
                        $('#pagination').prepend('<li style="margin-right:20px;margin-left:20px;">总页数：' + pages + ' 页</li>');
                        $('#pagination').prepend('<li>总条数：' + total + ' 条</li>');
                        if (type == "change") {
                            addItems(num, data.pageSize);
                            loadPage(pages, pageNum, total);
                        }
                    }
                });
            }
            // 获取城市天气
            function getCityWeather(cityName) {
                $.ajax({
                    url:"http://api.map.baidu.com/telematics/v3/weather",
                    type:"get",
                    data:{
                        location:cityName,
                        output:'json',
                        ak:'6tYzTvGZSOpYB5Oc2YGGOKt8'
                    },
                    /*预期服务器端返回的数据类型，假设我现在跨域了，我就改成jsonp 就可以了 */
                    dataType:"jsonp",
                    success:function(data){
                        // 百度那边的 数据已经回来，我现在要解析这个数据.
                        var weatherData = data.results[0].weather_data;

                        // 百度会返回给我们后四天的天气数据，只获取第一条数据，即当天的天气数据
                        var showTitle = weatherData[0];

                        // 填充顶部天气信息
                        var titleWeather = '';
                        titleWeather += '<span>' + showTitle.date + '</span>';
                        titleWeather += '<span style="margin-left: 15px;">' + showTitle.weather + '</span>';
                        $('#weather').html(titleWeather);

                        // 设置卡片天气详细信息
                        $('#weatherCity').html(cityName);
                        var dayUrl = '';
                        dayUrl += '<div>白天：<img src=' + showTitle.dayPictureUrl + '></div><br/>';
                        dayUrl += '<div>夜晚：<img src=' + showTitle.nightPictureUrl + '></div>';
                        $('#dayPicture').html(dayUrl);
                        $('#temperature').html(showTitle.temperature);
                        $('#wind').html(showTitle.weather + " " + showTitle.wind);
                    }
                });
            }
            // 将时间戳转换成 2017-10-01 22:10:10 格式的时间字符串
            function getMyDate(str){
                var oDate = new Date(str),
                        oYear = oDate.getFullYear(),
                        oMonth = oDate.getMonth()+1,
                        oDay = oDate.getDate(),
                        oHour = oDate.getHours(),
                        oMin = oDate.getMinutes(),
                        oSen = oDate.getSeconds(),
                        oTime = oYear +'-'+ zeroFill(oMonth) +'-'+ zeroFill(oDay) +' '+ zeroFill(oHour) +':'+ zeroFill(oMin) +':'+zeroFill(oSen);//最后拼接时间
                    return oTime;
            };
            // 补零
            function zeroFill(i){
                if (i >= 0 && i <= 9) {
                    return "0" + i;
                } else {
                    return i;
                }
            }
        </script>
    </body>

</html>